# -*- python -*-

import os
import os.path
import sys
import glob

fst_src = glob.glob('*.c')

Import('env install_prefix')
fst = env.Copy(CC="winegcc")
fst.Append (CPPPATH=".")

hackSDK = fst.Command('vst/aeffectx.h', 'vstsdk2.3/source/common/aeffectx.h', [
    Delete ('${TARGET.dir}'),
    Copy ('${TARGET.dir}', '${SOURCE.dir}'),
    "sed -i '/struct VstFileType\|struct VstFileSelect/,/};/d' $TARGET"
])

a = fst.Object ('fst', 'fst.c')
b = fst.Object ('fstinfofile', 'fstinfofile.c')
c = fst.Object ('vstwin', 'vstwin.c')
d = fst.Object ('vsti', 'vsti.c')

if fst['VST']:
    if os.access ('vst/aeffectx.h', os.F_OK):
        Default([hackSDK,a,b,c,d])
    else:
        print 'You have not installed the VST SDK in the correct location.'
        print 'Please see http://ardour.org/building_vst_support for more information'
        sys.exit (1)
    
env.Alias('tarball', env.Distribute (env['DISTTREE'],
                                     fst_src + ['SConscript',
                                                'fst.h',
                                                'jackvst.h'
                                                ] ))

